```toc

```
## Theory
**Stream** is an [[(API) Interfaces in Java main|interface]] first shown in <u>Java 8</u> for iterating throw stuff.
A **stream** is a sequence of objects that supports various methods which can be pipelined to produce the desired result.

A stream is not a data structure instead it takes input from the [[Collections framework in Java main|Collections]], [[Arrays in java main|Arrays]] or <u>I/O channels.</u>

> [!tldr] Important properties of the stream:
> - Streams don’t change the original data structure, they only provide the result as per the pipelined methods.
> -   Stream is lazy and evaluates code only when required.
> -   The elements of a stream are only visited once during the life of a stream. Like an Iterator, a new stream must be generated to revisit the same elements of the source



## Creating Stream

Stream is part of package:
```java
import java.util.stream;
//and for static methods
import java.util.stream.Stream;
```

This package consists of classes, interfaces and enum to allows functional-style operations on the elements.  

```java
public interface Stream<T> extends BaseStream<T,Stream<T>>
`T` - the type of the stream elements
```
to use it :
```java
     int sum = widgets.stream()
                      .sum();
```

### Parallel Stream
Parallels streams  works with  the same functions as normal streams
They increase performance since it works with multiple <u>threads</u>

To create parallel stream use:
```java
list.parallelStream()
```

How data flows throw parallel stream:
```java
int[] arr1 = {1, 2, 3, 4, 5};  
List<Integer> list = Arrays.stream(arr1).boxed().toList();  
  
List<Integer> increased = list.parallelStream()  
        .map(i -> {  
            System.out.println("Adding one to number: " + i);  
            return i+1;  
            }  
        )  
        .map(i-> {  
            System.out.println("Multiply by 2 number: " +i);  
            return i*2;  
        })  
        .collect(Collectors.toList());  
  
System.out.println(increased);
//OUT:
/*
Adding one to number: 3
Multiply by 2 number: 4
Adding one to number: 5
Multiply by 2 number: 6
Adding one to number: 4
Multiply by 2 number: 5
Adding one to number: 2
Multiply by 2 number: 3
Adding one to number: 1
Multiply by 2 number: 2
[4, 6, 8, 10, 12]
```

## Static methods of the stream class
Mostly the are used to create  streams of different kinds:

| Method                                                                             | What it does                                                                                                                                                                                 |
| ---------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| static `<T>` Stream.Builder`<T>` builder()                                         | Returns a builder for a Stream.                                                                                                                                                              |
| static `<T>` Stream`<T>`  concat(Stream`<? extends T>` a, Stream`<? extends T>` b) | Creates a lazily concatenated stream whose elements are all the elements of the first stream followed by all the elements of the second stream.                                              |
| static `<T>` Stream`<T>` empty()                                                   | Returns an empty sequential Stream.                                                                                                                                                          |
| static `<T>` Stream`<T>`  generate(Supplier`<T>` s)                                | Returns an infinite sequential unordered stream where each element is generated by the provided Supplier.                                                                                    |
| static `<T>` Stream`<T>`  iterate(T seed, UnaryOperator`<T>` f)                    | Returns an infinite sequential ordered Stream produced by iterative application of a function f to an initial element seed, producing a Stream consisting of seed, f(seed), f(f(seed)), etc. |
| static `<T>` Stream`<T>`  of(T... values)                                          | Returns a sequential ordered stream whose elements are the specified values.                                                                                                                 |
| static `<T>` Stream`<T>`  of(T t)                                                  | Returns a sequential Stream containing a single element.                                                                                                                                     |

```java
Stream.of(1.5, 2.3, 3.7)  
        .mapToInt(Double::intValue)  
        .forEach(System.out::println); //OUT: 1,2
```
## Different Operations On Streams

### Intermediate Operations

All _Intermediate_ operations are lazy, so they’re not executed until a result of a processing is actually needed.

Basically, _intermediate_ operations return a new stream. Executing an intermediate operation does not actually perform any operation, but instead creates a new stream that, when traversed, contains the elements of the initial stream that match the given predicate.

**As such, traversal of the _Stream_ doesn’t begin until the _terminal_ operation of the pipeline is executed.**

That is very important property, specifically important for infinite streams – because it allows us to create streams that will be actually invoked only when a _Terminal_ operation is called.

Type - can be used before final ones and all return the stream instance
Several intermediate operations can be used
<u>Example:</u>
```java
List<Integer> arr = Arrays.asList(2,6,4,-1,0,-4);  
List modified = arr.stream()  //this gets squares of all >0 and <5
                           .filter(i -> i > 0)  
                           .filter(i -> i < 5)  
                           .map(i -> i = i*i)  
                           .collect(Collectors.toList());  
System.out.println(modified); //OUT: [4, 16]
```



> [!warning] Pay attention!
> Map and filter method can be performed SWAPPED in streams.
> If you need some operation to be performed BEFORE filtering use **peek()** method

Sometimes map and filter method, can be performed swapped in java.

for example this code will produce nullpointer in map:

```java
Map<Integer, Integer> counterMap = new HashMap<>();  
return Arrays.stream(elements)  
	.map(e -> counterMap.merge(e, 1, Integer::sum))  
	.filter(e -> counterMap.get(e) <= maxOccurrences)  //this will throw null pointer
	.toArray();  
//to fix use
Arrays.stream(elements)  
	.peek(e -> counterMap.merge(e, 1, Integer::sum))  
	.filter(e -> counterMap.get(e) <= maxOccurrences)  
	.toArray();

```

#### .map method
The map method is used to returns a stream consisting of the results of applying the given function to the elements of this stream.

```java
<R> Stream<R> map(Function<? super T,? extends R> mapper)
```

<u>Example:</u>
```java
    List<Integer> number = Arrays.asList(2,3,4,5);
    List square = number.stream().map(x->x*x).collect(Collectors.toList());
    //OUT: [4, 9, 16, 25]
```

#### .flatMap method
Its similar to map, but is used with streams of smth that needed to be streamed itself:
![[flatmap-method-in-java-8.png]]

```java
<R> Stream<R> flatMap(Function<? super T,? extends Stream<? extends R>> mapper)
```

<u>Example:</u>
```JAVA
List country = Stream.of(Arrays.asList("Colombia", "Finland", "Greece", "Iceland", "Liberia", "Mali", "Mauritius"), Arrays.asList("Peru", "Serbia", "Singapore", "Turkey", "Uzbekistan", "Yemen", "Zimbabwe", "Greece", "Iceland")).flatMap(List::stream) .collect(Collectors.toList());
```

DIFFERENCES with map:

| Stream.flatMap()                                                                                     | Stream.map()                                                                                   |
| ---------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| It processes the stream of stream's values.                                                          | It processes the stream of values.                                                             |
| It performs mapping along with flattening.                                                           | It performs mapping only.                                                                      |
| It transforms data from Stream`<stream>` to Stream.                                                  | It transforms data from Stream to Stream.                                                      |
| It uses One-To-Many mapping.                                                                         | It uses One-To-One mapping.                                                                    |
| It's mapper function produces multiple values (stream of values) for each input value.               | It's mapper function produces single values for each input value.                              |
| Use the flatMap() method when the mapper function is producing multiple values for each input value. | Use the map() method when the mapper function is producing single values for each input value. |

#### .filter method 

The filter method is used to select elements as per the Predicate passed as argument.

```java
Stream<T> filter(Predicate<? super T> predicate)
```

<u>Example:</u>
```java
    List names = Arrays.asList("Reflection","Collection","Stream");
    List result = names.stream().filter(s - s.startsWith("S")).collect(Collectors.toList());
```
If you need more filters, use more than one one, after another

#### .sorted method

Returns a stream consisting of the elements of this stream, sorted according to natural order. 

```java
Stream<T> sorted()
//Or with custom Comparator
Stream<T> sorted(Comparator<? super T>)
```

<u>Example:</u>
```java
List<String> names = Arrays.asList("Reflection","Collection","Stream");  
List result = names.stream()  
        .sorted()  
        .collect(Collectors.toList());
//OUT: [Collection, Reflection, Stream]
```

> [!error] java.lang.ClassCastException con be thrown in runtime
> If the elements of this stream are not Comparable

#### All intermediate operations

| Method                                                                                | What it does                                                                                                                                                                                                                                                                                                                                                                      |
| ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| static `<T> Stream.Builder<T>` builder()                                              | It returns a builder for a Stream.                                                                                                                                                                                                                                                                                                                                                |
| static `<T> Stream<T>` concat(Stream`<? extends T>` a, Stream`<? extends T>` b)       | It creates a lazily concatenated stream whose elements are all the elements of the first stream followed by all the elements of the second stream. The resulting stream is ordered if both of the input streams are ordered, and parallel if either of the input streams is parallel. When the resulting stream is closed, the close handlers for both input streams are invoked. |
| Stream`<T>` distinct()                                                                | It returns a stream consisting of the distinct elements (according to Object.equals(Object)) of this stream.                                                                                                                                                                                                                                                                      |
| static `<T>` Stream`<T>` empty()                                                      | It returns an empty sequential Stream.                                                                                                                                                                                                                                                                                                                                            |
| Stream`<T>` filter(Predicate`<? super T>` predicate)                                  | It returns a stream consisting of the elements of this stream that match the given predicate.                                                                                                                                                                                                                                                                                     |
| `<R>` Stream`<R>` flatMap(Function`<? super T,? extends Stream<? extends R>>` mapper) | It returns a stream consisting of the results of replacing each element of this stream with the contents of a mapped stream produced by applying the provided mapping function to each element. Each mapped stream is closed after its contents have been placed into this stream. (If a mapped stream is null an empty stream is used, instead.)                                 |
| DoubleStream flatMapToDouble(Function`<? super T,? extends DoubleStream>` mapper)     | It returns a DoubleStream consisting of the results of replacing each element of this stream with the contents of a mapped stream produced by applying the provided mapping function to each element. Each mapped stream is closed after its contents have placed been into this stream. (If a mapped stream is null an empty stream is used, instead.)                           |
| IntStream flatMapToInt(Function`<? super T,? extends IntStream>` mapper)              | It returns an IntStream consisting of the results of replacing each element of this stream with the contents of a mapped stream produced by applying the provided mapping function to each element. Each mapped stream is closed after its contents have been placed into this stream. (If a mapped stream is null an empty stream is used, instead.)                             |
| LongStream flatMapToLong(Function`<? super T,? extends LongStream>` mapper)           | It returns a LongStream consisting of the results of replacing each element of this stream with the contents of a mapped stream produced by applying the provided mapping function to each element. Each mapped stream is closed after its contents have been placed into this stream. (If a mapped stream is null an empty stream is used, instead.)                             |
| static `<T>` Stream`<T>` generate(Supplier`<T>` s)                                    | It returns an infinite sequential unordered stream where each element is generated by the provided Supplier. This is suitable for generating constant streams, streams of random elements, etc.                                                                                                                                                                                   |
| static `<T>` Stream`<T>` iterate(T seed,UnaryOperator`<T>` f)                         | It returns an infinite sequential ordered Stream produced by iterative application of a function f to an initial element seed, producing a Stream consisting of seed, f(seed), f(f(seed)), etc.                                                                                                                                                                                   |
| Stream`<T>` limit(long maxSize)                                                       | It returns a stream consisting of the elements of this stream, truncated to be no longer than maxSize in length.                                                                                                                                                                                                                                                                  |
| `<R>` Stream`<R>` map(Function`<? super T,? extends R>` mapper)                       | It returns a stream consisting of the results of applying the given function to the elements of this stream.                                                                                                                                                                                                                                                                      |
| DoubleStream mapToDouble(ToDoubleFunction`<? super T>` mapper)                        | It returns a DoubleStream consisting of the results of applying the given function to the elements of this stream.                                                                                                                                                                                                                                                                |
| IntStream mapToInt(ToIntFunction`<? super T>` mapper)                                 | It returns an IntStream consisting of the results of applying the given function to the elements of this stream.                                                                                                                                                                                                                                                                  |
| LongStream mapToLong(ToLongFunction`<? super T>` mapper)                              | It returns a LongStream consisting of the results of applying the given function to the elements of this stream.                                                                                                                                                                                                                                                                  |
| @SafeVarargs static `<T>` Stream`<T>` of(T... values)                                 | It returns a sequential ordered stream whose elements are the specified values.                                                                                                                                                                                                                                                                                                   |
| static `<T>` Stream`<T>` of(T t)                                                      | It returns a sequential Stream containing a single element.                                                                                                                                                                                                                                                                                                                       |
| Stream`<T>` peek(Consumer`<? super T>` action)                                        | It returns a stream consisting of the elements of this stream, additionally performing the provided action on each element as elements are consumed from the resulting stream.                                                                                                                                                                                                    |
| Stream`<T>` skip(long n)                                                              | It returns a stream consisting of the remaining elements of this stream after discarding the first n elements of the stream. If this stream contains fewer than n elements then an empty stream will be returned.                                                                                                                                                                 |
| Stream`<T>` sorted()                                                                  | It returns a stream consisting of the elements of this stream, sorted according to natural order. If the elements of this stream are not Comparable, a `java.lang.ClassCastExceptio`n may be thrown when the terminal operation is executed.                                                                                                                                      |
| Stream`<T>` sorted(Comparator`<? super T>` comparator)                                | It returns a stream consisting of the elements of this stream, sorted according to the provided Comparator.                                                                                                                                                                                                                                                                       |


### Terminal Operations:
Type - that is used in the end and returns different stuff

#### .collect() method 
The collect method is used to return the result of the intermediate operations performed on the stream.
Difference from the reduce method - it can produce a collection, or a value

It performs a mutable reduction operation on the elements of this stream using a [[Collector API in java|Collector]] . 
there are a bach of usefull [[Collectors class]]

A [[Collector API in java|Collector]] encapsulates the functions used as arguments to collect(Supplier, BiConsumer, BiConsumer), allowing for reuse of collection strategies and composition of collect operations such as multiple-level grouping or partitioning.

```java
<R,A> R collect(Collector<? super T,A,R> collector)
```
However its easier to use one of the methods of the [[Collectors class|collectors class]] to create a needed Collector
<u>Example:</u>
```java
    List number = Arrays.asList(2,3,4,5,3);
    Set square = number.stream().map(x->x*x).collect(Collectors.toSet());
   //OUT: [4, 9, 16, 25]
``` 

#### .forEach method
forEach: The forEach method is used to iterate through every element of the stream

```java
void forEach(Consumer<? super T> action)
```

<u>Example:</u>
 ```java
   List<Integer> number = Arrays.asList(2,3,4,5);
    number.stream().map(x->x*x).forEach(y->System.out.print(y));
    //OUT: 491625
```

#### Reduction methods
This are methods use to aggregate the stream to one value: 
##### .reduce method
reduce: The reduce method is used to reduce the elements of a stream to a single value.
It performs a reduction on the elements of this stream, using an associative accumulation function, and returns an [[Optional Class in Java|Optional]] describing the reduced value, if any.

```java
Optional<T> reduce(BinaryOperator<T> accumulator) 
```
or
It performs a reduction on the elements of this stream, using the provided identity value and an associative accumulation function, and returns the reduced value

```java
T reduce(T identity, BinaryOperator<T> accumulator)
```
_Identity_ – an element that is the initial value of the reduction operation and the default result if the stream is empty

> [!NOTE]
> [[Optional Class in Java|Optional]] is returned only if  the initial value is not specified

<u>Example:</u>
```jAVA
    List<Integer> number = Arrays.asList(2,3,4,5);
    //Here ans variable is assigned 0 as the initial value and i is added to it .
    int even = number.stream().reduce(0,(ans,i)-> ans+i);
//OUT: 14
//or without identity:
list.stream()  
        .reduce((acc,i) -> acc +i ) //OUT: Optional[55] OR if list is empty OUT : Optional.empty

//OR
list.stream()  
        .reduce((acc,i) -> acc +i )  
        .orElse(0); // OUT: 55 and if list is empty OUT : 0
```

##### Other aggregation methods
all this are special cases of reduce method

```java
double sum() //the sum of elements in this stream

long count() //an `OptionalDouble` containing the average element of this stream, or an empty optional if the stream is empty

OptionalDouble average() // an `OptionalDouble` containing the average element of this stream, or an empty optional if the stream is empty

OptionalInt min() // an `OptionalInt` containing the minimum element of this stream, or an empty `OptionalInt` if the stream is empty

OptionalInt max() // an `OptionalInt` containing the maximum element of this stream, or an empty `OptionalInt` if the stream is empty

IntSummaryStatistics summaryStatistics() //Returns an `IntSummaryStatistics` describing various summary data about the elements of this stream.
```

<u>Example:</u>
```java
List<Double> number = Arrays.asList(2.5,3.0,4.3,5.0);  
  
var sum = number.stream().mapToDouble(x -> x).sum(); //have to use map to double, without TROWS compilation ERROR, since compiler doesnt know  the type  
var count = number.stream().count();  
var average = number.stream().mapToDouble(x -> x).average();  
var min = number.stream().mapToDouble(x -> x).min();  
var max = number.stream().mapToDouble(x -> x).max();  
var summary = number.stream().mapToDouble(x -> x).summaryStatistics();  
  
  
System.out.println(sum);  
System.out.println(count);  
System.out.println(average);  
System.out.println(min);  
System.out.println(max);  
System.out.println(summary);
```

<u>Output:</u>
```
14.8
4
OptionalDouble[3.7]
OptionalDouble[2.5]
OptionalDouble[5.0]
DoubleSummaryStatistics{count=4, sum=14,800000, min=2,500000, average=3,700000, max=5,000000}
```

To convert from Optional double to double use:
```java
public double getAsDouble()
```

<u>Example:</u>
```java
  public static boolean betterThanAverage(int[] classPoints, int yourPoints) {
    // Your code here
  return yourPoints > Arrays.stream(classPoints)
                            .average()
                            .getAsDouble();
  }
```

Or use orElse method from [[Optional Class in Java#.orElse() method|Optional class]]

<u>Example:</u>
```java
  public static boolean betterThanAverage(int[] classPoints, int yourPoints) {
    // Your code here
    return yourPoints > Arrays.stream(classPoints).avercolage().orElse(0);
```

#### All terminal operations
| Method                                                                                                       | What it does                                                                                                                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| boolean allMatch(Predicate`<? super T>` predicate)                                                           | It returns all elements of this stream which match the provided predicate. If the stream is empty then true is returned and the predicate is not evaluated.                                                                                                                                                                           |
| boolean anyMatch(Predicate`<? super T>` predicate)                                                           | It returns any element of this stream that matches the provided predicate. If the stream is empty then false is returned and the predicate is not evaluated.                                                                                                                                                                          |
| boolean noneMatch(Predicate`<? super T>` predicate)                                                          | It returns elements of this stream match the provided predicate. If the stream is empty then true is returned and the predicate is not evaluated.                                                                                                                                                                                     |
| void forEach(Consumer`<? super T>` action)                                                                   | It performs an action for each element of this stream.                                                                                                                                                                                                                                                                                |
| void forEachOrdered(Consumer`<? super T>` action)                                                            | It performs an action for each element of this stream, in the encounter order of the stream if the stream has a defined encounter order.                                                                                                                                                                                              |
| `<`R,A`>` R collect(Collector`<? super T,A,R>` collector)                                                    | It performs a mutable reduction operation on the elements of this stream using a Collector. A Collector encapsulates the functions used as arguments to collect(Supplier, BiConsumer, BiConsumer), allowing for reuse of collection strategies and composition of collect operations such as multiple-level grouping or partitioning. |
| `<`R`>` R collect(Supplier`<R>` supplier, BiConsumer`<R,? super T>` accumulator, BiConsumer`<R,R>` combiner) | It performs a mutable reduction operation on the elements of this stream. A mutable reduction is one in which the reduced value is a mutable result container, such as an ArrayList, and elements are incorporated by updating the state of the result rather than by replacing the result.                                           |
| long count()                                                                                                 | It returns the count of elements in this stream. This is a special case of a reduction.                                                                                                                                                                                                                                               |
| Optional`<T>` findAny()                                                                                      | It returns an Optional describing some element of the stream, or an empty Optional if the stream is empty.                                                                                                                                                                                                                            |
| Optiona`l<T>` findFirst()                                                                                    | It returns an Optional describing the first element of this stream, or an empty Optional if the stream is empty. If the stream has no encounter order, then any element may be returned.                                                                                                                                              |
| Optional`<T>` max(Comparator`<? super T>` comparator)                                                        | It returns the maximum element of this stream according to the provided Comparator. This is a special case of a reduction.                                                                                                                                                                                                            |
| Optional`<T>` min(Comparator`<? super T>` comparator)                                                        | It returns the minimum element of this stream according to the provided Comparator. This is a special case of a reduction.                                                                                                                                                                                                            |
| Optional`<T>` reduce(BinaryOperator`<T>` accumulator)                                                        | It performs a reduction on the elements of this stream, using an associative accumulation function, and returns an Optional describing the reduced value, if any.                                                                                                                                                                     |
| T reduce(T identity, BinaryOperator`<T>` accumulator)                                                        | It performs a reduction on the elements of this stream, using the provided identity value and an associative accumulation function, and returns the reduced value.                                                                                                                                                                    |
| `<U>` U reduce(U identity, BiFunction`<U,? super T,U>` accumulator, BinaryOperator`<U>` combiner)            | It performs a reduction on the elements of this stream, using the provided identity, accumulation and combining functions.                                                                                                                                                                                                            |
| Object`[]` toArray()                                                                                         | It returns an array containing the elements of this stream.                                                                                                                                                                                                                                                                           |
| `<A>` A`[]` toArray(IntFunction`<A[]>` generator)                                                            | It returns an array containing the elements of this stream, using the provided generator function to allocate the returned array, as well as any additional arrays that might be required for a partitioned execution or for resizing.                                                                                                |

## Streams of primitives


## Infinite Streams
Let’s say that we want to create an infinite stream of elements from zero that will be incremented by two. Then we need to limit that sequence before calling terminal operation.

**It is crucial to use a _limit()_ method before executing a _collect()_ method** that is a terminal operation, otherwise our program will run indefinitely:

```java
// given
Stream<Integer> infiniteStream = Stream.iterate(0, i -> i + 2);

// when
List<Integer> collect = infiniteStream
  .limit(10)
  .collect(Collectors.toList());

// then
assertEquals(collect, Arrays.asList(0, 2, 4, 6, 8, 10, 12, 14, 16, 18));
```

We created an infinite stream using an _iterate()_ method. Then we called a _limit()_ transformation and a _collect()_ terminal operation. Then in our resulting _List,_ we will have first 10 elements of an infinite sequence due to a laziness of a _Stream._

 **Infinite Stream of a Custom Type of Elements**

Let’s say that we want to create an infinite stream of random _UUIDs_.

The first step to achieving this using _Stream_ API is to create a _Supplier_ of those random values:

```java
Supplier<UUID> randomUUIDSupplier = UUID::randomUUID;
```

When we define a supplier we can create an infinite stream using a _generate()_ method:

```java
Stream<UUID> infiniteStreamOfRandomUUID = Stream.generate(randomUUIDSupplier);
```

Then we could take a couple of elements from that stream. We need to remember to use a _limit()_ method if we want our program to finish in a finite time

to create thuis streams use static stream methods